from maya import *
import maya.cmds as cmds
import os 
fa=mel.eval('addNewShelfTab("MAYA2SP")')
cmds.shelfButton(parent=fa, annotation='MAYA2SP', image1=os.environ['HOME'].replace("/","\\")+"\maya\scripts\MAYA2SP_icon\MAYA2SP_Shelf_ICON.png", command="import os\nimport sys\nimport subprocess\nfrom maya import cmds\n\nUDIM = \"False\"\nALLMESH = \"False\"\n\n\ndef onUDIM():\n    udim = cmds.checkBox('udim', q=True, v=True)\n    if udim == 1:\n        UDIM = \"True\"\n    else:\n        UDIM = \"False\"\n    return UDIM\n\n\ndef onALLMESH():\n    allmesh = cmds.checkBox('allmesh', q=True, v=True)\n    if allmesh == 1:\n        ALLMESH = \"True\"\n    else:\n        ALLMESH = \"False\"\n    return ALLMESH\n\n\n\ndef createrFolder(path):\n    folder = os.path.exists(path)\n    if folder == False:\n        os.makedirs(path)\n    return path\n\n\ndef getsppath():\n    fp = open(\"c:/ProgramData/Autodesk/maya2sppath.txt\", \"r\")\n    sppath = fp.read()\n    return sppath\n\n\ndef ontoSubPaint(*args):\n    mayafilepath = cmds.file(query=True, list=True)\n    list = mayafilepath[0]\n    filename = mayafilepath[0].split(\"/\").pop()\n    mayafolderpath = list.replace(filename, \"\")\n    createrFolder(mayafolderpath + filename.split(\".\")[0] + \"_maya2sp\");\n    exportfbxpath = \"\\\"\" + mayafolderpath + filename.split(\".\")[0] + \"_maya2sp\" + \"/\" + filename.split(\".\")[\n        0] + '.fbx' + \"\\\"\"\n    exportSPPpath = \"\\\"\" + mayafolderpath + filename.split(\".\")[0] + \"_maya2sp\" + \"/\" + filename.split(\".\")[\n        0] + '.spp' + \"\\\"\"\n    spexepath=getsppath().replace(\"/\",'\\\\\\\\')\n    exporttexturepath=\"\\\"\" + mayafolderpath + filename.split(\".\")[0] + \"_maya2sp\" + \"/\"\n    \n    if onALLMESH() == \"True\":\n        mel.eval(\n            'file -force -options \"groups=1;ptgroups=1;materials=1;smoothing=1;normals=1\" -typ \"FBX export\" -pr -es ' + exportfbxpath + ';')\n    if onALLMESH() == \"False\":\n        mel.eval('file -force -options \"v=0;\" -type \"FBX export\" -pr -ea ' + exportfbxpath + ';')\n    if onUDIM()==\"False\":\n        exepath=\"\\\"\"+spexepath+\"\\\"\"+\" --mesh \"+exportfbxpath.replace(\"/\",'\\\\\\\\')+\" \"+exportSPPpath.replace(\"/\",'\\\\\\\\')+\" --export-path \"+exporttexturepath\n        print(exepath)\n        subprocess.Popen(exepath)\n    if onUDIM()==\"True\":\n        udmi=\" --split-by-udim\"\n        exepath=\"\\\"\"+spexepath+\"\\\"\"+\" --mesh \"+exportfbxpath.replace(\"/\",'\\\\\\\\')+\" \"+exportSPPpath.replace(\"/\",'\\\\\\\\')+udmi+\" --export-path \"+exporttexturepath\n        print(exepath)\n        subprocess.Popen(exepath)\n\n\ndef writetxt(path): \n    if(path!=\"\"):  \n        fp = open(\"c:/ProgramData/Autodesk/maya2sppath.txt\", \"w\")\n        fp.write(path)\n        fp.close()\n\n\ndef onSetClick(*args):\n    sppath = cmds.fileDialog(dm='*Painter.exe')\n    writetxt(sppath)\n    \ndef getIcon(icon):\n    maya2spscript=os.environ['HOME'].replace(\"/\",\"\\\\\")+\"\\maya\\scripts\"\n    icons=os.path.join(maya2spscript,\"MAYA2SP_icon\")\n    icon=os.path.join(icons,icon)\n    print(icon)\n    return icon\n\ndef getIcon2(icon):\n    maya2spscript=os.environ['HOME'].replace(\"/\",\"\\\\\")+\"\\maya\\scripts\"\n    icons=os.path.join(maya2spscript,\"MAYA2SP_icon\")\n    icon=os.path.join(icons,icon)\n    print(icon)\n    return icon\n    \n\ndef showWindow():\n    spname = \"Maya2SP V1.0\"\n    if cmds.window(spname, query=True, exists=True):\n        cmds.deleteUI(spname)\n    cmds.window(spname, height=270, width=206)\n    cmds.showWindow()\n\n    cmds.columnLayout()\n    \n    cmds.iconTextButton(image1=getIcon('maya2sp.png'),width=203)\n   \n    row = cmds.columnLayout()\n    cmds.rowLayout(numberOfColumns=2)\n    cmds.text(label=\"Substance Path:                       \")\n    \n    cmds.iconTextButton(image2=getIcon2('maya2sp_set.png'),command=onSetClick,width=15,height=15)\n    cmds.setParent(row)\n\n    cmds.text(label=\"----------------------------------------\")\n    \n    cmds.text(label=\"Substance Option:\", align='left')\n    columnb = cmds.columnLayout(adjustableColumn=True)\n    cmds.rowLayout(numberOfColumns=2)\n    udim = cmds.checkBox(\"udim\", label=\"Create UDIM\", cc='onUDIM()')\n    allmesh = cmds.checkBox(\"allmesh\", label=\"Select MESH\", cc='onALLMESH()')\n    cmds.setParent(columnb)\n    cmds.setParent()\n    cmds.text(label=\"\")\n    cmds.text(label=\"Export Substance:\", align='left')\n    cmds.text(label=\"\")\n    cmds.button(label='To Substance Painter', command=ontoSubPaint)\n    cmds.text(label=\"\")\n    cmds.text(label=\"Replace MESH:\", align='left')\n    cmds.text(label=\"\")\n    cmds.button(label='Replace MESH',command=ontoSubPaint)\n\nshowWindow()\n")